{
    "status": "Failed",
    "error": {
        "code": "VMExtensionProvisioningError",
        "message": "VM has reported a failure when processing extension 'dscextension'. Error message: \"DSC Configuration 'CreateHostPoolAndRegisterSessionHost' completed with error(s). Following are the first few: PowerShell DSC resource MSFT_ScriptResource  failed to execute Test-TargetResource functionality with error message: Some error occurred in DSC CreateHostPool TestScript: \r\n\r\nException             : System.Exception: Error authenticating Windows Virtual Desktop account, ServicePrincipal = \r\n                        False ---> System.AggregateException: One or more errors occurred. ---> \r\n                        Microsoft.IdentityModel.Clients.ActiveDirectory.AdalException: unknown_user_type: Unknown User \r\n                        Type\r\n                           at Microsoft.RDInfra.RDPowershell.Interfaces.AdalHelper.HandleAdalException(AdalException \r\n                        adalException) in C:\\agent\\_work\\2\\s\\src\\RDPowershell\\src\\Microsoft.RDInfra.RDPowershell\\Interfa\r\n                        ces\\AdalHelper.cs:line 275\r\n                           at \r\n                        Microsoft.RDInfra.RDPowershell.Interfaces.AdalHelper.<GetAcquireTokenAsync>d__3.MoveNext() in C:\r\n                        \\agent\\_work\\2\\s\\src\\RDPowershell\\src\\Microsoft.RDInfra.RDPowershell\\Interfaces\\AdalHelper.cs:li\r\n                        ne 117\r\n                        --- End of stack trace from previous location where exception was thrown ---\r\n                           at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n                           at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task \r\n                        task)\r\n                           at Microsoft.RDInfra.RDPowershell.Context.AddRdsAccount.<>c__DisplayClass6_0.<<BeginProcessin\r\n                        g>b__1>d.MoveNext() in C:\\agent\\_work\\2\\s\\src\\RDPowershell\\src\\Microsoft.RDInfra.RDPowershell\\Co\r\n                        ntext\\AddRdsAccount.cs:line 90\r\n                           --- End of inner exception stack trace ---\r\n                           at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)\r\n                           at System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken \r\n                        cancellationToken)\r\n                           at Microsoft.RDInfra.RDPowershell.Context.AddRdsAccount.BeginProcessing() in C:\\agent\\_work\\2\r\n                        \\s\\src\\RDPowershell\\src\\Microsoft.RDInfra.RDPowershell\\Context\\AddRdsAccount.cs:line 90\r\n                           at System.Management.Automation.Cmdlet.DoBeginProcessing()\r\n                           at System.Management.Automation.CommandProcessorBase.DoBegin()\r\n                           --- End of inner exception stack trace ---\r\nTargetObject          : \r\nCategoryInfo          : OperationStopped: (:) [], Exception\r\nFullyQualifiedErrorId : Error authenticating Windows Virtual Desktop account, ServicePrincipal = False\r\nErrorDetails          : \r\nInvocationInfo        : System.Management.Automation.InvocationInfo\r\nScriptStackTrace      : at AuthenticateRdsAccount, \r\n                        C:\\Packages\\Plugins\\Microsoft.Powershell.DSC\\2.83.1.0\\DSCWork\\Configuration.0\\Functions.ps1: \r\n                        line 182\r\n                        at <ScriptBlock>, C:\\Packages\\Plugins\\Microsoft.Powershell.DSC\\2.83.1.0\\DSCWork\\Configuration.0\\\r\n                        Script-TestHostPoolExists.ps1: line 56\r\n                        at <ScriptBlock>, <No file>: line 26\r\n                        at ScriptExecutionHelper, C:\\Windows\\system32\\WindowsPowerShell\\v1.0\\Modules\\PSDesiredStateConfi\r\n                        guration\\DscResources\\MSFT_ScriptResource\\MSFT_ScriptResource.psm1: line 317\r\n                        at Test-TargetResource, C:\\Windows\\system32\\WindowsPowerShell\\v1.0\\Modules\\PSDesiredStateConfigu\r\n                        ration\\DscResources\\MSFT_ScriptResource\\MSFT_ScriptResource.psm1: line 209\r\nPipelineIterationInfo : {}\r\nPSMessageDetails      : \r\n\r\n\r\n\r\n  PowerShell DSC resource MSFT_ScriptResource  failed to execute Set-TargetResource functionality with error message: Some error occurred in DSC RegisterSessionHostAndAddDefaultUsers SetScript: \r\n\r\nException             : System.Exception: Error authenticating Windows Virtual Desktop account, ServicePrincipal = \r\n                        False ---> System.AggregateException: One or more errors occurred. ---> \r\n                        Microsoft.IdentityModel.Clients.ActiveDirectory.AdalException: unknown_user_type: Unknown User \r\n                        Type\r\n                           at Microsoft.RDInfra.RDPowershell.Interfaces.AdalHelper.HandleAdalException(AdalException \r\n                        adalException) in C:\\agent\\_work\\2\\s\\src\\RDPowershell\\src\\Microsoft.RDInfra.RDPowershell\\Interfa\r\n                        ces\\AdalHelper.cs:line 275\r\n                           at \r\n                        Microsoft.RDInfra.RDPowershell.Interfaces.AdalHelper.<GetAcquireTokenAsync>d__3.MoveNext() in C:\r\n                        \\agent\\_work\\2\\s\\src\\RDPowershell\\src\\Microsoft.RDInfra.RDPowershell\\Interfaces\\AdalHelper.cs:li\r\n                        ne 117\r\n                        --- End of stack trace from previous location where exception was thrown ---\r\n                           at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n                           at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task \r\n                        task)\r\n                           at Microsoft.RDInfra.RDPowershell.Context.AddRdsAccount.<>c__DisplayClass6_0.<<BeginProcessin\r\n                        g>b__1>d.MoveNext() in C:\\agent\\_work\\2\\s\\src\\RDPowershell\\src\\Microsoft.RDInfra.RDPowershell\\Co\r\n                        ntext\\AddRdsAccount.cs:line 90\r\n                           --- End of inner exception stack trace ---\r\n                           at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)\r\n                           at System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken \r\n                        cancellationToken)\r\n                           at Microsoft.RDInfra.RDPowershell.Context.AddRdsAccount.BeginProcessing() in C:\\agent\\_work\\2\r\n                        \\s\\src\\RDPowershell\\src\\Microsoft.RDInfra.RDPowershell\\Context\\AddRdsAccount.cs:line 90\r\n                           at System.Management.Automation.Cmdlet.DoBeginProcessing()\r\n                           at System.Management.Automation.CommandProcessorBase.DoBegin()\r\n                           --- End of inner exception stack trace ---\r\nTargetObject          : \r\nCategoryInfo          : OperationStopped: (:) [], Exception\r\nFullyQualifiedErrorId : Error authenticating Windows Virtual Desktop account, ServicePrincipal = False\r\nErrorDetails          : \r\nInvocationInfo        : System.Management.Automation.InvocationInfo\r\nScriptStackTrace      : at AuthenticateRdsAccount, \r\n                        C:\\Packages\\Plugins\\Microsoft.Powershell.DSC\\2.83.1.0\\DSCWork\\Configuration.0\\Functions.ps1: \r\n                        line 182\r\n                        at <ScriptBlock>, C:\\Packages\\Plugins\\Microsoft.Powershell.DSC\\2.83.1.0\\DSCWork\\Configuration.0\\\r\n                        Script-RegisterSessionHost.ps1: line 70\r\n                        at <ScriptBlock>, <No file>: line 31\r\n                        at ScriptExecutionHelper, C:\\Windows\\system32\\WindowsPowerShell\\v1.0\\Modules\\PSDesiredStateConfi\r\n                        guration\\DscResources\\MSFT_ScriptResource\\MSFT_ScriptResource.psm1: line 317\r\n                        at Set-TargetResource, C:\\Windows\\system32\\WindowsPowerShell\\v1.0\\Modules\\PSDesiredStateConfigur\r\n                        ation\\DscResources\\MSFT_ScriptResource\\MSFT_ScriptResource.psm1: line 153\r\nPipelineIterationInfo : {}\r\nPSMessageDetails      : \r\n\r\n\r\n\r\n  The SendConfigurationApply function did not succeed.\"\r\n\r\nMore information on troubleshooting is available at https://aka.ms/VMExtensionDSCWindowsTroubleshoot "
    }
}
